<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Robot Control Dashboard</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        min-height: 100vh;
        color: white;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 30px;
      }

      .main-panel {
        display: flex;
        flex-direction: column;
        gap: 30px;
      }

      .header {
        text-align: center;
        margin-bottom: 20px;
      }

      .header h1 {
        font-size: 2.2em;
        margin: 0 0 10px 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .status-badge {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: bold;
        font-size: 0.9em;
        letter-spacing: 1px;
        background: #27ae60;
        box-shadow: 0 0 15px rgba(39, 174, 96, 0.4);
      }

      .hands-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
      }

      .hand-panel {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 25px;
        transition: all 0.3s ease;
      }

      .hand-panel:hover {
        transform: translateY(-3px);
        background: rgba(255, 255, 255, 0.15);
      }

      .hand-title {
        font-size: 1.4em;
        margin-bottom: 20px;
        text-align: center;
        font-weight: bold;
      }

      .hand-state {
        text-align: center;
        margin-bottom: 15px;
        font-weight: bold;
        padding: 8px 16px;
        border-radius: 15px;
        font-size: 0.9em;
      }

      .hand-state.active {
        background: #27ae60;
        color: white;
      }

      .hand-state.inactive {
        background: #e74c3c;
        color: white;
      }

      .movement-section {
        margin: 15px 0;
      }

      .movement-label {
        font-size: 0.9em;
        margin-bottom: 8px;
        font-weight: bold;
        opacity: 0.8;
      }

      .direction-display {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 60px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 12px;
        margin-bottom: 8px;
      }

      .arrow {
        font-size: 2.5em;
        transition: all 0.3s ease;
        filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.3));
      }

      .arrow.left {
        transform: rotate(-90deg);
        color: #3498db;
      }

      .arrow.right {
        transform: rotate(90deg);
        color: #e67e22;
      }

      .arrow.straight {
        color: #27ae60;
      }

      .arrow.up {
        color: #9b59b6;
      }

      .arrow.down {
        transform: rotate(180deg);
        color: #f39c12;
      }

      .arrow.neutral {
        color: #95a5a6;
      }

      .arrow.not-active {
        color: #7f8c8d;
        opacity: 0.4;
      }

      .direction-label {
        text-align: center;
        font-weight: bold;
        font-size: 1em;
      }

      .console-panel {
        background: rgba(0, 0, 0, 0.8);
        border-radius: 15px;
        padding: 20px;
        height: fit-content;
      }

      .console-header {
        font-size: 1.2em;
        font-weight: bold;
        margin-bottom: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        padding-bottom: 10px;
      }

      .console-content {
        font-family: "Courier New", monospace;
        font-size: 0.85em;
        height: 400px;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.5);
        padding: 15px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .console-line {
        margin-bottom: 5px;
        white-space: pre-wrap;
        word-break: break-word;
      }

      .console-line.request {
        color: #3498db;
      }

      .console-line.response {
        color: #27ae60;
      }

      .console-line.error {
        color: #e74c3c;
      }

      .console-line.info {
        color: #f39c12;
      }

      .connection-info {
        text-align: center;
        margin-top: 20px;
        font-size: 0.9em;
        opacity: 0.8;
      }

      @media (max-width: 768px) {
        .container {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        .hands-section {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="main-panel">
        <div class="header">
          <h1>ðŸ¤– Robot Control Dashboard</h1>
          <div class="status-badge" id="statusBadge">System Active</div>
        </div>

        <div class="hands-section">
          <!-- Left Hand Panel -->
          <div class="hand-panel">
            <div class="hand-title">ðŸ‘ˆ Left Hand</div>
            <div class="hand-state" id="leftState">Active</div>

            <div class="movement-section">
              <div class="movement-label">Horizontal Movement</div>
              <div class="direction-display">
                <div class="arrow not-active" id="leftHorizontalArrow">â¬†</div>
              </div>
              <div class="direction-label" id="leftHorizontalLabel">Not Active</div>
            </div>

            <div class="movement-section">
              <div class="movement-label">Vertical Movement</div>
              <div class="direction-display">
                <div class="arrow not-active" id="leftVerticalArrow">â¬†</div>
              </div>
              <div class="direction-label" id="leftVerticalLabel">Not Active</div>
            </div>
          </div>

          <!-- Right Hand Panel -->
          <div class="hand-panel">
            <div class="hand-title">ðŸ‘‰ Right Hand</div>
            <div class="hand-state" id="rightState">Active</div>

            <div class="movement-section">
              <div class="movement-label">Horizontal Movement</div>
              <div class="direction-display">
                <div class="arrow not-active" id="rightHorizontalArrow">â¬†</div>
              </div>
              <div class="direction-label" id="rightHorizontalLabel">Not Active</div>
            </div>
          </div>
        </div>

        <div class="connection-info" id="connectionInfo">Connecting to server...</div>
      </div>

      <!-- Console Panel -->
      <div class="console-panel">
        <div class="console-header">ðŸ“Š Console & Debug Log</div>
        <div class="console-content" id="consoleContent">
          <div class="console-line info">System starting up...</div>
        </div>
      </div>
    </div>

    <script>
      let consoleContent = document.getElementById("consoleContent");
      let maxConsoleLines = 50;

      function addConsoleLog(message, type = "info") {
        const timestamp = new Date().toLocaleTimeString();
        const line = document.createElement("div");
        line.className = `console-line ${type}`;
        line.textContent = `[${timestamp}] ${message}`;

        consoleContent.appendChild(line);

        // Keep only last N lines
        while (consoleContent.children.length > maxConsoleLines) {
          consoleContent.removeChild(consoleContent.firstChild);
        }

        // Scroll to bottom
        consoleContent.scrollTop = consoleContent.scrollHeight;
      }

      function updateRobotState(state) {
        addConsoleLog(`Received state: ${JSON.stringify(state)}`, "response");

        if (state.hand) {
          // Update left hand
          if (state.hand.left) {
            updateHandState("left", state.hand.left);
            updateHandDirection("leftHorizontal", state.hand.left.horizontal);
            updateHandDirection("leftVertical", state.hand.left.vertical);
          }

          // Update right hand
          if (state.hand.right) {
            updateHandState("right", state.hand.right);
            updateHandDirection("rightHorizontal", state.hand.right.horizontal);
          }
        }
      }

      function updateHandState(hand, handData) {
        const stateElement = document.getElementById(`${hand}State`);
        const isActive = handData.active !== undefined ? handData.active : true;

        if (isActive) {
          stateElement.textContent = "Active";
          stateElement.className = "hand-state active";
        } else {
          stateElement.textContent = "Inactive";
          stateElement.className = "hand-state inactive";
        }
      }

      function updateHandDirection(elementPrefix, direction) {
        const arrowElement = document.getElementById(`${elementPrefix}Arrow`);
        const labelElement = document.getElementById(`${elementPrefix}Label`);

        if (!arrowElement || !labelElement) return;

        // Remove all direction classes
        arrowElement.className = "arrow";

        // Add appropriate class and update label
        switch (direction) {
          case "left":
            arrowElement.classList.add("left");
            labelElement.textContent = "â† Left";
            break;
          case "right":
            arrowElement.classList.add("right");
            labelElement.textContent = "Right â†’";
            break;
          case "straight":
            arrowElement.classList.add("straight");
            labelElement.textContent = "â†‘ Straight";
            break;
          case "up":
            arrowElement.classList.add("up");
            labelElement.textContent = "â†‘ Up";
            break;
          case "down":
            arrowElement.classList.add("down");
            labelElement.textContent = "â†“ Down";
            break;
          case "neutral":
            arrowElement.classList.add("neutral");
            labelElement.textContent = "âŠ™ Neutral";
            break;
          default: // 'not active'
            arrowElement.classList.add("not-active");
            labelElement.textContent = "Not Active";
            break;
        }
      }

      // Poll for state every 1s for better responsiveness
      function pollState() {
        addConsoleLog("Polling server for state...", "request");

        fetch("/api/state")
          .then((response) => response.json())
          .then((data) => {
            updateRobotState(data);
            document.getElementById("connectionInfo").textContent = "ðŸŸ¢ Connected - Last updated: " + new Date().toLocaleTimeString();
          })
          .catch((error) => {
            addConsoleLog(`Error connecting to server: ${error.message}`, "error");
            document.getElementById("connectionInfo").textContent = "ðŸ”´ Connection error - Retrying...";
          });
      }

      // Start polling
      addConsoleLog("Starting dashboard...", "info");
      pollState();
      setInterval(pollState, 500); // Poll every 1 second for better responsiveness
    </script>
  </body>
</html>
